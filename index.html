<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ZCPS by Lola â€” RÃ©servation</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#050517;
    --card:#0f1220;
    --muted:#bda98b;
    --gold:#d0b08a;
    --accent:#c79a60;
    --glass: rgba(255,255,255,0.03);
    --success:#25d366;
    --white: #f8f7f5;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    background: linear-gradient(180deg,#04040a 0%, var(--bg) 100%);
    color:var(--white);
    -webkit-font-smoothing:antialiased;
  }

  .wrap{max-width:460px;margin:0 auto;padding:16px;}
  header{display:flex;gap:12px;align-items:center;padding:12px 6px;border-radius:12px;margin-bottom:10px}
  .logo{width:64px;height:64px;border-radius:12px;overflow:hidden;background:linear-gradient(135deg,rgba(208,176,138,0.08),rgba(201,168,111,0.04));display:flex;align-items:center;justify-content:center}
  .logo img{width:100%;height:100%;object-fit:cover;display:block}
  .hdr-text{display:flex;flex-direction:column}
  .brand{font-family:"Playfair Display",serif;font-size:18px;color:var(--gold);line-height:1}
  .sub{font-size:13px;color:var(--muted);margin-top:3px;text-transform:lowercase}

  .lead{font-size:13px;color:var(--muted);margin:12px 0 14px}

  /* strip */
  .strip{display:flex;gap:8px;overflow-x:auto;padding:8px 4px;scrollbar-width:none;-webkit-overflow-scrolling:touch}
  .strip::-webkit-scrollbar{height:6px}
  .day{flex:0 0 auto;min-width:92px;padding:10px;border-radius:12px;text-align:center;border:1px solid rgba(255,255,255,0.03);cursor:pointer;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);transition:all .18s}
  .day .wk{font-size:12px;color:var(--muted);text-transform:capitalize}
  .day .d{font-size:18px;font-weight:700;margin-top:6px}
  .day .y{font-size:11px;color:var(--muted);margin-top:4px}
  .day:hover{transform:translateY(-4px)}
  .day.active{border-color:var(--accent);box-shadow:0 12px 30px rgba(0,0,0,0.45);transform:translateY(-6px)}

  /* planning */
  .planning{padding:8px 4px 140px;height:calc(100vh - 280px);overflow-y:auto}
  .hour{font-size:12px;color:var(--muted);margin:12px 0 8px}
  .slot{padding:12px;border-radius:12px;margin-bottom:10px;text-align:center;font-weight:800;cursor:pointer;border:1px solid rgba(255,255,255,0.04);background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);transition:transform .12s,box-shadow .12s}
  .slot.available:hover{transform:translateY(-4px);box-shadow:0 14px 30px rgba(0,0,0,0.5)}
  .slot.booked{opacity:0.26;cursor:not-allowed;border-color:rgba(255,0,0,0.08);background:linear-gradient(180deg,rgba(120,0,0,0.06),transparent)}
  .slot.selected{background:linear-gradient(135deg, rgba(208,176,138,0.18), rgba(199,154,96,0.12));color:#07101a;border-color:transparent;transform:scale(1.02)}

  /* bottom panel */
  .panel{position:fixed;left:0;right:0;bottom:0;padding:14px;background:linear-gradient(180deg,rgba(7,10,20,0.6),rgba(7,10,20,0.88));backdrop-filter:blur(6px);border-top:1px solid rgba(255,255,255,0.03)}
  .panel-inner{max-width:460px;margin:0 auto;display:flex;flex-direction:column;gap:10px;padding:0 16px}
  .sel-info{font-size:13px;color:var(--muted);text-align:center}
  .time-row{display:flex;gap:8px;align-items:center;justify-content:center}
  .time-display{min-width:120px;padding:10px;border-radius:10px;background:var(--glass);text-align:center;font-weight:800;color:var(--white)}
  .adj-btn{width:44px;height:44px;border-radius:10px;border:none;background:var(--gold);color:#07101a;font-weight:900;font-size:18px;cursor:pointer}
  .book-btn{background:linear-gradient(180deg,var(--gold),var(--accent));border:none;padding:14px;border-radius:12px;font-weight:900;font-size:16px;color:#07101a;cursor:pointer}
  .book-btn:disabled{opacity:0.6;cursor:not-allowed}

  .meta{font-size:12px;color:var(--muted);text-align:center}

  .admin{display:flex;gap:8px;justify-content:center;margin-top:6px}
  .admin button{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted);cursor:pointer}

  @media (max-width:420px){
    .day{min-width:82px}
    .logo{width:56px;height:56px}
  }
</style>
</head>
<body>
  <div class="wrap" role="main" aria-label="RÃ©servation ZCPS by Lola">
    <header>
      <div class="logo"><img src="logo.png" alt="ZCPS logo" /></div>
      <div class="hdr-text">
        <div class="brand">ZCPS</div>
        <div class="sub">rÃ©servation en ligne</div>
      </div>
    </header>

    <div class="lead">DurÃ©e 25 min Â· buffer configurable Â· rÃ©servation â‰¥ 2h Â· 24/7</div>

    <div id="daysStrip" class="strip" aria-label="SÃ©lection des jours"></div>

    <main id="planning" class="planning" aria-live="polite"></main>

    <div class="panel" aria-hidden="false">
      <div class="panel-inner">
        <div id="selInfo" class="sel-info">Aucun crÃ©neau sÃ©lectionnÃ©</div>

        <div id="adjuster" class="time-row" style="display:none">
          <button id="minus" class="adj-btn" aria-label="moins">âˆ’</button>
          <div id="timeDisplay" class="time-display">--:--</div>
          <button id="plus" class="adj-btn" aria-label="plus">+</button>
        </div>

        <button id="bookBtn" class="book-btn" disabled>Valider la rÃ©servation</button>

        <div class="meta">Les rÃ©servations sont partagÃ©es si `booked.json` existe dans le repo (optionnel).</div>

        <div class="admin">
          <button id="exportBtn" title="Exporter les rÃ©servations locales">Export bookings</button>
          <button id="reloadBtn" title="Charger booked.json depuis le repo">Reload remote bookings</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* =======================
   CONFIG â€” modifie ici si besoin
   ======================= */
const CONFIG = {
  PHONE: '33605656753',        // <-- TON NUMÃ‰RO WhatsApp (format international sans +)
  DAYS_COUNT: 14,              // nb jours visibles
  DISPLAY_STEP_MIN: 30,        // affichage crÃ©neaux (30min pour lisibilitÃ©)
  SLOT_DURATION_MIN: 25,       // durÃ©e service
  BUFFER_MIN: 30,              // buffer initial (modifiable inline)
  INCREMENT_MIN: 1,            // ajusteur minute step
  MIN_ADVANCE_HOURS: 2,        // dÃ©lai minimum avant rÃ©servation (tu as confirmÃ© 2h)
  REMOTE_BOOKED_PATH: './booked.json' // si prÃ©sent dans repo, sera fetchÃ©
};

/* =======================
   STATE
   ======================= */
let days = [];
let currentDayIndex = 0;
let remoteBooked = []; // [{start:"ISO"}]
let localBooked = [];  // [{start:"ISO"}] saved to localStorage
const LS_KEY = 'zcps_local_bookings_v1';
try { localBooked = JSON.parse(localStorage.getItem(LS_KEY) || '[]') } catch(e){ localBooked = [] }

let selected = null; // { start: Date }

/* =======================
   HELPERS
   ======================= */
const pad = n => String(n).padStart(2,'0');
const addMinutes = (d, m) => new Date(d.getTime() + m * 60000);
const slotKey = d => d.toISOString();
const isoDateKey = d => d.toISOString().split('T')[0];

function now(){ return new Date(); }

/* =======================
   REMOTE BOOKED (fetch booked.json if exists)
   ======================= */
async function loadRemoteBooked(){
  try{
    const res = await fetch(CONFIG.REMOTE_BOOKED_PATH + '?_=' + Date.now());
    if(!res.ok){ remoteBooked = []; return; }
    const data = await res.json();
    // accept either ["ISO","ISO"] or [{start:"ISO"},...]
    let arr = Array.isArray(data) ? data : [];
    if(arr.length && typeof arr[0] === 'string'){
      remoteBooked = arr.map(s => ({start: s}));
    } else {
      remoteBooked = arr.map(o => (typeof o === 'string' ? {start:o} : o));
    }
  }catch(e){
    console.warn('loadRemoteBooked fail', e);
    remoteBooked = [];
  }
}

/* =======================
   SAVE LOCAL
   ======================= */
function saveLocal(){
  try{ localStorage.setItem(LS_KEY, JSON.stringify(localBooked)); }catch(e){}
}

/* =======================
   DAYS GENERATION & RENDER
   ======================= */
function genDays(){
  days = [];
  const base = new Date();
  base.setHours(0,0,0,0);
  for(let i=0;i<CONFIG.DAYS_COUNT;i++){
    const d = new Date(base);
    d.setDate(base.getDate() + i);
    days.push(d);
  }
}

function renderDaysStrip(){
  const el = document.getElementById('daysStrip');
  el.innerHTML = '';
  days.forEach((d,i)=>{
    const div = document.createElement('div');
    div.className = 'day' + (i===0 ? ' active' : '');
    div.innerHTML = `<div class="wk">${labelDay(d,i)}</div><div class="d">${d.getDate()}/${d.getMonth()+1}</div><div class="y">${d.getFullYear()}</div>`;
    div.addEventListener('click', ()=>switchDay(i));
    el.appendChild(div);
  });
  // enable touch drag scroll naturally (native)
}

/* helper labels */
function labelDay(d,i){
  if(i===0) return "Aujourd'hui";
  if(i===1) return "Demain";
  return d.toLocaleDateString('fr-FR',{weekday:'short'});
}

/* =======================
   BOOKING OVERLAP LOGIC
   ======================= */
// returns true if candidate start overlaps any booked (considering duration + buffer)
function isOverlapping(candidateStart){
  const candEnd = addMinutes(candidateStart, CONFIG.SLOT_DURATION_MIN);
  const all = [...(remoteBooked||[]), ...(localBooked||[])];
  for(const b of all){
    const bs = new Date(b.start);
    const be = addMinutes(bs, CONFIG.SLOT_DURATION_MIN + CONFIG.BUFFER_MIN);
    if(candidateStart < be && candEnd > bs) return true;
  }
  return false;
}

// check final allowed (including 2h rule)
function isAllowed(candidateStart){
  const minAllowed = addMinutes(now(), CONFIG.MIN_ADVANCE_HOURS * 60);
  if(candidateStart < minAllowed) return false;
  if(isOverlapping(candidateStart)) return false;
  return true;
}

/* =======================
   RENDER PLANNING
   ======================= */
function renderPlanning(dayIndex){
  currentDayIndex = dayIndex;
  const container = document.getElementById('planning');
  container.innerHTML = '';
  const day = days[dayIndex];
  const today = now();
  for(let h=0; h<24; h++){
    const hourHeader = document.createElement('div');
    hourHeader.className = 'hour';
    hourHeader.textContent = `${h}h00`;
    container.appendChild(hourHeader);

    for(let m=0; m<60; m+=CONFIG.DISPLAY_STEP_MIN){
      const start = new Date(day);
      start.setHours(h,m,0,0);

      const blocked = !isAllowed(start);
      const slot = document.createElement('div');
      slot.className = 'slot ' + (blocked ? 'booked' : 'available');
      slot.textContent = `${pad(h)}:${pad(m)}`;

      if(!blocked){
        slot.addEventListener('click', ()=>selectSlot(start, slot));
      }
      container.appendChild(slot);
    }
  }
}

/* =======================
   SELECT SLOT & ADJUSTER
   ======================= */
function selectSlot(startDate, slotEl){
  // clear previous selected visuals
  document.querySelectorAll('.slot.selected').forEach(s=>s.classList.remove('selected'));
  slotEl.classList.add('selected');

  selected = { start: new Date(startDate) }; // base (minute adjustable)
  // show adjuster
  document.getElementById('adjuster').style.display = 'flex';
  document.getElementById('timeDisplay').textContent = formatTime(selected.start);
  document.getElementById('selInfo').textContent = `${selected.start.toLocaleDateString('fr-FR')} â€¢ ${formatTime(selected.start)}`;
  document.getElementById('bookBtn').disabled = false;
}

/* adjust +/- 1 minute (INCREMENT_MIN) */
document.addEventListener('click', (e)=>{
  // handlers are below added after DOM ready
});

function updateAdjustUI(){
  if(!selected) return;
  document.getElementById('timeDisplay').textContent = formatTime(selected.start);
  document.getElementById('selInfo').textContent = `${selected.start.toLocaleDateString('fr-FR')} â€¢ ${formatTime(selected.start)}`;
}

/* plus / minus button logic */
function plusMinute(){
  if(!selected) return;
  const candidate = addMinutes(selected.start, CONFIG.INCREMENT_MIN);
  if(!isAllowed(candidate)){ pulseInvalid(); return; }
  selected.start = candidate; updateAdjustUI();
}
function minusMinute(){
  if(!selected) return;
  const candidate = addMinutes(selected.start, -CONFIG.INCREMENT_MIN);
  if(!isAllowed(candidate)){ pulseInvalid(); return; }
  selected.start = candidate; updateAdjustUI();
}

function pulseInvalid(){
  const td = document.getElementById('timeDisplay');
  if(!td) return;
  td.animate([{transform:'scale(1)'},{transform:'scale(0.98)'},{transform:'scale(1)'}],{duration:220});
}

document.getElementById('plus').addEventListener('click', plusMinute);
document.getElementById('minus').addEventListener('click', minusMinute);

/* =======================
   BOOK (open WhatsApp + persist locally)
   ======================= */
document.getElementById('bookBtn').addEventListener('click', ()=>{
  if(!selected) return alert('Choisis dâ€™abord un crÃ©neau.');
  // final check
  if(!isAllowed(selected.start)){ alert('Ce crÃ©neau nâ€™est plus disponible.'); renderPlanning(currentDayIndex); return; }

  // save to localBooked
  localBooked.push({ start: selected.start.toISOString() });
  saveLocal();

  // update UI immediately (re-render this day to gray out overlapping slots)
  renderPlanning(currentDayIndex);

  // message
  const d = selected.start;
  const dateTxt = d.toLocaleDateString('fr-FR');
  const timeTxt = formatTime(d);
  const message = `Bonjour ðŸŒ¸ Je souhaite rÃ©server un crÃ©neau ZCPS le ${dateTxt} Ã  ${timeTxt} (durÃ©e ${CONFIG.SLOT_DURATION_MIN} min).`;
  const wa = `https://wa.me/${CONFIG.PHONE}?text=${encodeURIComponent(message)}`;

  // open WA in new window/tab
  window.open(wa, '_blank');
});

/* =======================
   ADMIN: export local+remote as booked-export.json
   ======================= */
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const combined = [...(remoteBooked || []), ...(localBooked || [])].map(x => typeof x === 'string' ? x : x.start);
  const uniq = Array.from(new Set(combined));
  const blob = new Blob([JSON.stringify(uniq, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'booked-export.json'; document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
  alert('booked-export.json gÃ©nÃ©rÃ© â€” commit/replace booked.json dans ton repo pour propager globalement.');
});

/* reload remote */
document.getElementById('reloadBtn').addEventListener('click', async ()=>{
  await init(true);
  alert('Remote bookings rechargÃ©s');
});

/* =======================
   UTIL
   ======================= */
function formatTime(d){ return `${pad(d.getHours())}:${pad(d.getMinutes())}`; }

/* switch day handler */
function switchDay(i){
  currentDayIndex = i;
  document.querySelectorAll('.day').forEach((el, idx)=>el.classList.toggle('active', idx===i));
  selected = null;
  document.getElementById('adjuster').style.display = 'none';
  document.getElementById('bookBtn').disabled = true;
  document.getElementById('selInfo').textContent = 'Aucun crÃ©neau sÃ©lectionnÃ©';
  renderPlanning(i);
}

/* =======================
   INIT
   ======================= */
async function init(skipFetch=false){
  genDays();
  renderDaysStrip();
  if(!skipFetch) await loadRemoteBooked();
  // normalize remote/local format
  remoteBooked = (remoteBooked || []).map(b => (typeof b === 'string' ? {start:b} : b));
  localBooked = (localBooked || []).map(b => (typeof b === 'string' ? {start:b} : b));
  renderPlanning(0);
}

/* start */
init();

/* expose some things for console debugging (optional) */
window.ZCPS = {
  config: CONFIG,
  reload: () => init(true),
  remoteBooked,
  localBooked,
};

/* keyboard accessibility: plus/minus with ArrowUp/ArrowDown when adjuster visible */
document.addEventListener('keydown', (e)=>{
  if(document.getElementById('adjuster').style.display === 'flex'){
    if(e.key === 'ArrowUp') { plusMinute(); e.preventDefault(); }
    if(e.key === 'ArrowDown') { minusMinute(); e.preventDefault(); }
  }
});
</script>
</body>
</html>  .lead{font-size:13px;color:var(--muted);margin:12px 0 14px}

  /* strip */
  .strip{display:flex;gap:8px;overflow-x:auto;padding:8px 4px;scrollbar-width:none;-webkit-overflow-scrolling:touch}
  .strip::-webkit-scrollbar{height:6px}
  .day{flex:0 0 auto;min-width:92px;padding:10px;border-radius:12px;text-align:center;border:1px solid rgba(255,255,255,0.03);cursor:pointer;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);transition:all .18s}
  .day .wk{font-size:12px;color:var(--muted);text-transform:capitalize}
  .day .d{font-size:18px;font-weight:700;margin-top:6px}
  .day .y{font-size:11px;color:var(--muted);margin-top:4px}
  .day:hover{transform:translateY(-4px)}
  .day.active{border-color:var(--accent);box-shadow:0 12px 30px rgba(0,0,0,0.45);transform:translateY(-6px)}

  /* planning */
  .planning{padding:8px 4px 140px;height:calc(100vh - 280px);overflow-y:auto}
  .hour{font-size:12px;color:var(--muted);margin:12px 0 8px}
  .slot{padding:12px;border-radius:12px;margin-bottom:10px;text-align:center;font-weight:800;cursor:pointer;border:1px solid rgba(255,255,255,0.04);background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);transition:transform .12s,box-shadow .12s}
  .slot.available:hover{transform:translateY(-4px);box-shadow:0 14px 30px rgba(0,0,0,0.5)}
  .slot.booked{opacity:0.26;cursor:not-allowed;border-color:rgba(255,0,0,0.08);background:linear-gradient(180deg,rgba(120,0,0,0.06),transparent)}
  .slot.selected{background:linear-gradient(135deg, rgba(208,176,138,0.18), rgba(199,154,96,0.12));color:#07101a;border-color:transparent;transform:scale(1.02)}

  /* bottom panel */
  .panel{position:fixed;left:0;right:0;bottom:0;padding:14px;background:linear-gradient(180deg,rgba(7,10,20,0.6),rgba(7,10,20,0.88));backdrop-filter:blur(6px);border-top:1px solid rgba(255,255,255,0.03)}
  .panel-inner{max-width:460px;margin:0 auto;display:flex;flex-direction:column;gap:10px;padding:0 16px}
  .sel-info{font-size:13px;color:var(--muted);text-align:center}
  .time-row{display:flex;gap:8px;align-items:center;justify-content:center}
  .time-display{min-width:120px;padding:10px;border-radius:10px;background:var(--glass);text-align:center;font-weight:800;color:var(--white)}
  .adj-btn{width:44px;height:44px;border-radius:10px;border:none;background:var(--gold);color:#07101a;font-weight:900;font-size:18px;cursor:pointer}
  .book-btn{background:linear-gradient(180deg,var(--gold),var(--accent));border:none;padding:14px;border-radius:12px;font-weight:900;font-size:16px;color:#07101a;cursor:pointer}
  .book-btn:disabled{opacity:0.6;cursor:not-allowed}

  .meta{font-size:12px;color:var(--muted);text-align:center}

  .admin{display:flex;gap:8px;justify-content:center;margin-top:6px}
  .admin button{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted);cursor:pointer}

  @media (max-width:420px){
    .day{min-width:82px}
    .logo{width:56px;height:56px}
  }
</style>
</head>
<body>
  <div class="wrap" role="main" aria-label="RÃ©servation ZCPS by Lola">
    <header>
      <div class="logo"><img src="logo.png" alt="ZCPS logo" /></div>
      <div class="hdr-text">
        <div class="brand">ZCPS</div>
        <div class="sub">rÃ©servation en ligne</div>
      </div>
    </header>

    <div class="lead">DurÃ©e 25 min Â· buffer configurable Â· rÃ©servation â‰¥ 2h Â· 24/7</div>

    <div id="daysStrip" class="strip" aria-label="SÃ©lection des jours"></div>

    <main id="planning" class="planning" aria-live="polite"></main>

    <div class="panel" aria-hidden="false">
      <div class="panel-inner">
        <div id="selInfo" class="sel-info">Aucun crÃ©neau sÃ©lectionnÃ©</div>

        <div id="adjuster" class="time-row" style="display:none">
          <button id="minus" class="adj-btn" aria-label="moins">âˆ’</button>
          <div id="timeDisplay" class="time-display">--:--</div>
          <button id="plus" class="adj-btn" aria-label="plus">+</button>
        </div>

        <button id="bookBtn" class="book-btn" disabled>Valider la rÃ©servation</button>

        <div class="meta">Les rÃ©servations sont partagÃ©es si `booked.json` existe dans le repo (optionnel).</div>

        <div class="admin">
          <button id="exportBtn" title="Exporter les rÃ©servations locales">Export bookings</button>
          <button id="reloadBtn" title="Charger booked.json depuis le repo">Reload remote bookings</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* =======================
   CONFIG â€” modifie ici si besoin
   ======================= */
const CONFIG = {
  PHONE: '33605656753',        // <-- TON NUMÃ‰RO WhatsApp (format international sans +)
  DAYS_COUNT: 14,              // nb jours visibles
  DISPLAY_STEP_MIN: 30,        // affichage crÃ©neaux (30min pour lisibilitÃ©)
  SLOT_DURATION_MIN: 25,       // durÃ©e service
  BUFFER_MIN: 30,              // buffer initial (modifiable inline)
  INCREMENT_MIN: 1,            // ajusteur minute step
  MIN_ADVANCE_HOURS: 2,        // dÃ©lai minimum avant rÃ©servation (tu as confirmÃ© 2h)
  REMOTE_BOOKED_PATH: './booked.json' // si prÃ©sent dans repo, sera fetchÃ©
};

/* =======================
   STATE
   ======================= */
let days = [];
let currentDayIndex = 0;
let remoteBooked = []; // [{start:"ISO"}]
let localBooked = [];  // [{start:"ISO"}] saved to localStorage
const LS_KEY = 'zcps_local_bookings_v1';
try { localBooked = JSON.parse(localStorage.getItem(LS_KEY) || '[]') } catch(e){ localBooked = [] }

let selected = null; // { start: Date }

/* =======================
   HELPERS
   ======================= */
const pad = n => String(n).padStart(2,'0');
const addMinutes = (d, m) => new Date(d.getTime() + m * 60000);
const slotKey = d => d.toISOString();
const isoDateKey = d => d.toISOString().split('T')[0];

function now(){ return new Date(); }

/* =======================
   REMOTE BOOKED (fetch booked.json if exists)
   ======================= */
async function loadRemoteBooked(){
  try{
    const res = await fetch(CONFIG.REMOTE_BOOKED_PATH + '?_=' + Date.now());
    if(!res.ok){ remoteBooked = []; return; }
    const data = await res.json();
    // accept either ["ISO","ISO"] or [{start:"ISO"},...]
    let arr = Array.isArray(data) ? data : [];
    if(arr.length && typeof arr[0] === 'string'){
      remoteBooked = arr.map(s => ({start: s}));
    } else {
      remoteBooked = arr.map(o => (typeof o === 'string' ? {start:o} : o));
    }
  }catch(e){
    console.warn('loadRemoteBooked fail', e);
    remoteBooked = [];
  }
}

/* =======================
   SAVE LOCAL
   ======================= */
function saveLocal(){
  try{ localStorage.setItem(LS_KEY, JSON.stringify(localBooked)); }catch(e){}
}

/* =======================
   DAYS GENERATION & RENDER
   ======================= */
function genDays(){
  days = [];
  const base = new Date();
  base.setHours(0,0,0,0);
  for(let i=0;i<CONFIG.DAYS_COUNT;i++){
    const d = new Date(base);
    d.setDate(base.getDate() + i);
    days.push(d);
  }
}

function renderDaysStrip(){
  const el = document.getElementById('daysStrip');
  el.innerHTML = '';
  days.forEach((d,i)=>{
    const div = document.createElement('div');
    div.className = 'day' + (i===0 ? ' active' : '');
    div.innerHTML = `<div class="wk">${labelDay(d,i)}</div><div class="d">${d.getDate()}/${d.getMonth()+1}</div><div class="y">${d.getFullYear()}</div>`;
    div.addEventListener('click', ()=>switchDay(i));
    el.appendChild(div);
  });
  // enable touch drag scroll naturally (native)
}

/* helper labels */
function labelDay(d,i){
  if(i===0) return "Aujourd'hui";
  if(i===1) return "Demain";
  return d.toLocaleDateString('fr-FR',{weekday:'short'});
}

/* =======================
   BOOKING OVERLAP LOGIC
   ======================= */
// returns true if candidate start overlaps any booked (considering duration + buffer)
function isOverlapping(candidateStart){
  const candEnd = addMinutes(candidateStart, CONFIG.SLOT_DURATION_MIN);
  const all = [...(remoteBooked||[]), ...(localBooked||[])];
  for(const b of all){
    const bs = new Date(b.start);
    const be = addMinutes(bs, CONFIG.SLOT_DURATION_MIN + CONFIG.BUFFER_MIN);
    if(candidateStart < be && candEnd > bs) return true;
  }
  return false;
}

// check final allowed (including 2h rule)
function isAllowed(candidateStart){
  const minAllowed = addMinutes(now(), CONFIG.MIN_ADVANCE_HOURS * 60);
  if(candidateStart < minAllowed) return false;
  if(isOverlapping(candidateStart)) return false;
  return true;
}

/* =======================
   RENDER PLANNING
   ======================= */
function renderPlanning(dayIndex){
  currentDayIndex = dayIndex;
  const container = document.getElementById('planning');
  container.innerHTML = '';
  const day = days[dayIndex];
  const today = now();
  for(let h=0; h<24; h++){
    const hourHeader = document.createElement('div');
    hourHeader.className = 'hour';
    hourHeader.textContent = `${h}h00`;
    container.appendChild(hourHeader);

    for(let m=0; m<60; m+=CONFIG.DISPLAY_STEP_MIN){
      const start = new Date(day);
      start.setHours(h,m,0,0);

      const blocked = !isAllowed(start);
      const slot = document.createElement('div');
      slot.className = 'slot ' + (blocked ? 'booked' : 'available');
      slot.textContent = `${pad(h)}:${pad(m)}`;

      if(!blocked){
        slot.addEventListener('click', ()=>selectSlot(start, slot));
      }
      container.appendChild(slot);
    }
  }
}

/* =======================
   SELECT SLOT & ADJUSTER
   ======================= */
function selectSlot(startDate, slotEl){
  // clear previous selected visuals
  document.querySelectorAll('.slot.selected').forEach(s=>s.classList.remove('selected'));
  slotEl.classList.add('selected');

  selected = { start: new Date(startDate) }; // base (minute adjustable)
  // show adjuster
  document.getElementById('adjuster').style.display = 'flex';
  document.getElementById('timeDisplay').textContent = formatTime(selected.start);
  document.getElementById('selInfo').textContent = `${selected.start.toLocaleDateString('fr-FR')} â€¢ ${formatTime(selected.start)}`;
  document.getElementById('bookBtn').disabled = false;
}

/* = days[dayIndex];

            const [h, m] = time.split(":");
            const end = new Date(d);
            end.setHours(parseInt(h), parseInt(m) + intervalMinutes);
            const endTime = `${String(end.getHours()).padStart(2,"0")}:${String(end.getMinutes()).padStart(2,"0")}`;

            document.getElementById("valDate").textContent = `${formatDay(d, dayIndex)} â€¢ ${formatDate(d)}`;
            document.getElementById("valTime").textContent = `${time} â†’ ${endTime}`;

            document.getElementById("validation").classList.add("show");
        }


        /**************** WHATSAPP ****************/
        function confirmBooking() {
            const date = document.getElementById("valDate").textContent;
            const time = document.getElementById("valTime").textContent;

            const msg = `âš¡ ZAPS - Je confirme ma rÃ©servation pour ${date} de ${time}`;
            window.location.href = `https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`;
        }

        /**************** INIT ****************/
        renderDays();
        renderPlanning(0);
    </script>

</body>
</html>            -webkit-text-fill-color: transparent;
            margin-bottom: 6px;
        }

        /* JOUR */
        .days-nav {
            display: flex;
            overflow-x: auto;
            scrollbar-width: none;
            gap: 10px;
            padding: 15px;
            background: rgba(255,255,255,0.05);
        }

        .days-nav::-webkit-scrollbar { display: none; }

        .day-tab {
            flex: 0 0 auto;
            padding: 12px 18px;
            border-radius: 14px;
            border: 2px solid rgba(255,165,0,0.4);
            cursor: pointer;
            text-align: center;
            transition: 0.2s;
        }

        .day-tab.active {
            background: linear-gradient(135deg, #ffa500, #ff69b4, #40e0d0);
            color: #0a0e27;
            font-weight: 900;
        }

        .day-name {
            font-size: 14px;
            font-weight: 700;
        }

        .day-date {
            font-size: 12px;
            opacity: 0.9;
        }

        /* PLANNING */
        .planning {
            padding: 20px;
            padding-bottom: 160px;
            height: calc(100vh - 240px);
            overflow-y: auto;
        }

        .hour-separator {
            text-align: left;
            margin: 12px 0 6px;
            font-size: 12px;
            text-transform: uppercase;
            color: rgba(255,165,0,0.7);
        }

        /* SLOT */
        .time-slot {
            padding: 18px;
            margin-bottom: 12px;
            font-size: 20px;
            font-weight: 700;
            text-align: center;
            border-radius: 14px;
            transition: 0.25s;
            cursor: pointer;
            border: 2px solid rgba(255,165,0,0.4);
            background: rgba(255,255,255,0.05);
        }

        .time-slot.available:hover {
            background: rgba(255,165,0,0.15);
        }

        .time-slot.booked {
            background: rgba(239,68,68,0.25);
            border-color: rgba(239,68,68,0.5);
            color: rgba(255,255,255,0.6);
            cursor: not-allowed;
            position: relative;
        }

        .time-slot.booked::after {
            content: "ðŸ”’";
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.8;
        }

        .time-slot.selected {
            background: linear-gradient(135deg, #ffa500, #ff69b4, #40e0d0);
            color: #0a0e27;
            font-weight: 900;
            transform: scale(1.03);
            border-color: transparent;
        }

        /* VALIDATION */
        .validation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 22px;
            background: #ffffff10;
            backdrop-filter: blur(12px);
            border-top: 2px solid rgba(255,165,0,0.5);
            transform: translateY(110%);
            transition: 0.35s ease;
        }

        .validation.show {
            transform: translateY(0);
        }

        .validation-date {
            text-align: center;
            font-size: 16px;
            margin-bottom: 4px;
            color: #ffd79c;
        }

        .validation-time {
            text-align: center;
            font-size: 20px;
            font-weight: 900;
            margin-bottom: 18px;
        }

        .btn-validate {
            width: 100%;
            padding: 18px;
            border-radius: 16px;
            border: none;
            background: #25d366;
            color: white;
            font-size: 20px;
            font-weight: 800;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-validate:active {
            transform: scale(0.96);
        }
    </style>
</head>


<body>

    <!-- Header -->
    <div class="header">
        <h1>âš¡ RÃ©servation ZAPS</h1>
        <p>Choisissez votre crÃ©neau</p>
    </div>

    <!-- Navigation jours -->
    <div class="days-nav" id="daysNav"></div>

    <!-- Planning -->
    <div class="planning" id="planning"></div>

    <!-- Validation -->
    <div class="validation" id="validation">
        <div class="validation-date" id="valDate"></div>
        <div class="validation-time" id="valTime"></div>

        <button class="btn-validate" onclick="confirmBooking()">
            Confirmer sur WhatsApp ðŸ’¬
        </button>
    </div>

    <script>
        /**************** CONFIG ****************/
        const WHATSAPP = "33605656753";
        const intervalMinutes = 30; // CRÃ‰NEAUX DE 30 MIN (modifier ici si tu veux)
        
        // Exemple de slots rÃ©servÃ©s
        const bookedSlots = {
            "2025-11-29": ["10:00", "14:30"],
            "2025-11-30": ["16:00"]
        };

        let selectedSlot = null;
        let currentDay = 0;


        /**************** FONCTIONS DATES ****************/
        function getDays() {
            const days = [];
            for (let i = 0; i < 7; i++) {
                const d = new Date();
                d.setDate(d.getDate() + i);
                days.push(d);
            }
            return days;
        }

        function getDateKey(date) {
            return date.toISOString().split("T")[0];
        }

        function formatDay(date, index) {
            if (index === 0) return "Aujourd'hui";
            if (index === 1) return "Demain";
            return date.toLocaleDateString("fr-FR", { weekday: "long" });
        }

        function formatDate(date) {
            return date.toLocaleDateString("fr-FR", { day: "numeric", month: "long" });
        }


        /**************** GÃ‰NÃ‰RATION CRÃ‰NEAUX ****************/
        function isBooked(date, time) {
            const key = getDateKey(date);
            return bookedSlots[key]?.includes(time) || false;
        }

        function generateTimeSlots(date, isToday) {
            const now = new Date();
            let hStart = 8;  // ouverture par dÃ©faut

            if (isToday) {
                const currentH = now.getHours();
                if (currentH > hStart) hStart = currentH;
            }

            const slots = [];
            for (let h = hStart; h < 22; h++) {
                for (let m = 0; m < 60; m += intervalMinutes) {
                    const time = `${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}`;

                    slots.push({
                        type: "slot",
                        date,
                        time,
                        booked: isBooked(date, time)
                    });
                }
            }
            return slots;
        }


        /**************** RENDU INTERFACE ****************/
        function renderDays() {
            const days = getDays();
            const nav = document.getElementById("daysNav");

            nav.innerHTML = days.map((d, i) => `
                <div class="day-tab ${i === 0 ? "active" : ""}" onclick="switchDay(${i})">
                    <div class="day-name">${formatDay(d, i)}</div>
                    <div class="day-date">${formatDate(d)}</div>
                </div>
            `).join("");
        }

        function renderPlanning(dayIndex) {
            const days = getDays();
            const date = days[dayIndex];
            const slots = generateTimeSlots(date, dayIndex === 0);
            const container = document.getElementById("planning");

            let html = "";

            let currentHour = -1;
            for (const slot of slots) {
                const h = slot.time.split(":")[0];
                if (h != currentHour) {
                    html += `<div class="hour-separator">${h}h00</div>`;
                    currentHour = h;
                }

                html += `
                    <div class="time-slot ${slot.booked ? "booked" : "available"}"
                         id="${slot.time.replace(":", "")}"
                         ${slot.booked ? "" : `onclick="selectSlot('${slot.time}', ${dayIndex})"`}>
                        ${slot.time}
                    </div>
                `;
            }

            container.innerHTML = html;
        }


        /**************** INTERACTION ****************/
        function switchDay(i) {
            currentDay = i;
            selectedSlot = null;

            document.querySelectorAll(".day-tab").forEach((d, idx) => d.classList.toggle("active", idx === i));
            document.getElementById("validation").classList.remove("show");

            renderPlanning(i);
        }

        function selectSlot(time, dayIndex) {
            if (selectedSlot) {
                document.getElementById(selectedSlot.replace(":", "")).classList.remove("selected");
            }

            selectedSlot = time;
            document.getElementById(time.replace(":", "")).classList.add("selected");

            const days = getDays();
            const d = days[dayIndex];

            const [h, m] = time.split(":");
            const end = new Date(d);
            end.setHours(parseInt(h), parseInt(m) + intervalMinutes);
            const endTime = `${String(end.getHours()).padStart(2,"0")}:${String(end.getMinutes()).padStart(2,"0")}`;

            document.getElementById("valDate").textContent = `${formatDay(d, dayIndex)} â€¢ ${formatDate(d)}`;
            document.getElementById("valTime").textContent = `${time} â†’ ${endTime}`;

            document.getElementById("validation").classList.add("show");
        }


        /**************** WHATSAPP ****************/
        function confirmBooking() {
            const date = document.getElementById("valDate").textContent;
            const time = document.getElementById("valTime").textContent;

            const msg = `âš¡ ZAPS - Je confirme ma rÃ©servation pour ${date} de ${time}`;
            window.location.href = `https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`;
        }

        /**************** INIT ****************/
        renderDays();
        renderPlanning(0);
    </script>

</body>
</html>
        /* HEADER */
        .header {
            padding: 40px 24px 32px;
            background: rgba(10, 14, 39, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-subtle);
            position: relative;
            overflow: hidden;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gradient-primary);
            opacity: 0.6;
        }

        .brand {
            text-align: center;
            margin-bottom: 12px;
        }

        .brand h1 {
            font-size: 36px;
            font-weight: 900;
            letter-spacing: -0.5px;
            background: var(--gradient-primary);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientFlow 6s ease infinite;
            margin-bottom: 4px;
        }

        .brand .copyright {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            letter-spacing: 1px;
        }

        @keyframes gradientFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .tagline {
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        /* LEGEND */
        .legend {
            display: flex;
            justify-content: center;
            gap: 32px;
            padding: 20px 24px;
            background: rgba(10, 14, 39, 0.4);
            backdrop-filter: blur(10px);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            position: relative;
        }

        .legend-dot.available {
            background: var(--gradient-primary);
            box-shadow: 0 0 12px rgba(255, 107, 53, 0.4);
        }

        .legend-dot.booked {
            background: rgba(239, 68, 68, 0.3);
            border: 2px solid rgba(239, 68, 68, 0.6);
        }

        /* DAYS NAVIGATION */
        .days-nav {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            background: rgba(10, 14, 39, 0.6);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-subtle);
            gap: 1px;
        }

        .days-nav::-webkit-scrollbar {
            display: none;
        }

        .day-tab {
            flex: 0 0 33.333%;
            padding: 20px 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            scroll-snap-align: start;
            background: var(--bg-card);
            position: relative;
        }

        .day-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .day-tab.active {
            background: rgba(255, 107, 53, 0.08);
        }

        .day-tab.active::after {
            transform: scaleX(1);
        }

        .day-name {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 6px;
            color: var(--text-primary);
        }

        .day-date {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        /* PLANNING */
        .planning {
            padding: 24px 16px 120px;
            height: calc(100vh - 300px);
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .planning::-webkit-scrollbar {
            width: 4px;
        }

        .planning::-webkit-scrollbar-track {
            background: transparent;
        }

        .planning::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 53, 0.3);
            border-radius: 2px;
        }

        .hour-block {
            margin-bottom: 32px;
        }

        .hour-label {
            font-size: 13px;
            font-weight: 700;
            color: rgba(255, 107, 53, 0.7);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 16px;
            padding-left: 4px;
        }

        .slots-grid {
            display: grid;
            gap: 12px;
        }

        .time-slot {
            padding: 20px;
            background: var(--bg-card);
            border: 2px solid var(--border-subtle);
            border-radius: 16px;
            text-align: center;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .time-slot::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .time-slot .time-text {
            position: relative;
            z-index: 1;
        }

        .time-slot.available:active {
            transform: scale(0.96);
        }

        .time-slot.available:hover::before {
            opacity: 0.1;
        }

        .time-slot.booked {
            background: rgba(239, 68, 68, 0.05);
            border-color: rgba(239, 68, 68, 0.2);
            color: rgba(255, 255, 255, 0.3);
            cursor: not-allowed;
        }

        .time-slot.booked::after {
            content: 'âœ•';
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            color: rgba(239, 68, 68, 0.5);
        }

        .time-slot.selected {
            background: var(--gradient-primary);
            border-color: transparent;
            transform: scale(1.02);
            box-shadow: var(--shadow-glow);
        }

        .time-slot.selected::before {
            opacity: 1;
        }

        .time-slot.selected::after {
            content: 'âœ“';
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            color: white;
            animation: checkmark 0.3s ease;
        }

        @keyframes checkmark {
            0% { transform: translateY(-50%) scale(0); }
            50% { transform: translateY(-50%) scale(1.2); }
            100% { transform: translateY(-50%) scale(1); }
        }

        /* VALIDATION PANEL */
        .validation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 24px;
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border-subtle);
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 100;
        }

        .validation.show {
            transform: translateY(0);
        }

        .validation::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gradient-primary);
        }

        .validation-content {
            max-width: 500px;
            margin: 0 auto;
        }

        .validation-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .validation-label {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .validation-date {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .validation-time {
            font-size: 28px;
            font-weight: 900;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .btn-validate {
            width: 100%;
            padding: 18px;
            background: var(--gradient-primary);
            border: none;
            border-radius: 16px;
            font-size: 17px;
            font-weight: 900;
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            box-shadow: var(--shadow-glow);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .btn-validate::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .btn-validate:hover::before {
            opacity: 1;
        }

        .btn-validate:active {
            transform: scale(0.97);
        }

        /* FOOTER */
        .footer {
            position: fixed;
            bottom: 12px;
            right: 12px;
            font-size: 10px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.3);
            letter-spacing: 0.5px;
            pointer-events: none;
            z-index: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="brand">
                <h1>ZCPSÂ©</h1>
                <div class="copyright">by Lola</div>
            </div>
            <p class="tagline">RÃ©servez votre crÃ©neau en quelques clics</p>
        </header>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-dot available"></div>
                <span>Disponible</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot booked"></div>
                <span>RÃ©servÃ©</span>
            </div>
        </div>

        <nav class="days-nav" id="daysNav"></nav>
        
        <main class="planning" id="planning"></main>

        <aside class="validation" id="validation">
            <div class="validation-content">
                <div class="validation-header">
                    <div class="validation-label">Votre rÃ©servation</div>
                    <div class="validation-date" id="valDate"></div>
                    <div class="validation-time" id="valTime"></div>
                </div>
                <button class="btn-validate" onclick="confirmBooking()">
                    Confirmer sur WhatsApp
                </button>
            </div>
        </aside>

        <footer class="footer">ZCPSÂ© by Lola</footer>
    </div>

    <script>
        const WHATSAPP = '33605656753';
        let selectedSlot = null;
        let currentDay = 0;

        const bookedSlots = {
            '2025-11-29': ['14:30', '10:00'],
            '2025-11-30': ['16:15']
        };

        function getDays() {
            const days = [];
            for (let i = 0; i < 7; i++) {
                const d = new Date();
                d.setDate(d.getDate() + i);
                days.push(d);
            }
            return days;
        }

        function formatDayName(date, index) {
            if (index === 0) return 'Aujourd\'hui';
            if (index === 1) return 'Demain';
            const day = date.toLocaleDateString('fr-FR', { weekday: 'long' });
            return day.charAt(0).toUpperCase() + day.slice(1);
        }

        function formatDate(date) {
            return date.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' });
        }

        function getDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        function isBooked(date, time) {
            const key = getDateKey(date);
            return bookedSlots[key]?.includes(time) || false;
        }

        function generateTimeSlots(date, isToday) {
            const now = new Date();
            const startHour = isToday ? now.getHours() : 0;
            const hours = {};

            for (let h = startHour; h < 24; h++) {
                hours[h] = [];
                for (let m = 0; m < 60; m += 15) {
                    const time = `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
                    const booked = isBooked(date, time);
                    hours[h].push({ time, booked, date });
                }
            }
            return hours;
        }

        function renderDays() {
            const days = getDays();
            const nav = document.getElementById('daysNav');
            nav.innerHTML = days.map((day, i) => `
                <div class="day-tab ${i === 0 ? 'active' : ''}" onclick="switchDay(${i})">
                    <div class="day-name">${formatDayName(day, i)}</div>
                    <div class="day-date">${formatDate(day)}</div>
                </div>
            `).join('');
        }

        function renderPlanning(dayIndex) {
            const days = getDays();
            const day = days[dayIndex];
            const hourSlots = generateTimeSlots(day, dayIndex === 0);
            const planning = document.getElementById('planning');
            
            planning.innerHTML = Object.entries(hourSlots).map(([hour, slots]) => `
                <div class="hour-block">
                    <div class="hour-label">${String(hour).padStart(2, '0')}:00</div>
                    <div class="slots-grid">
                        ${slots.map(slot => {
                            const id = `${getDateKey(slot.date)}_${slot.time}`;
                            const classes = slot.booked ? 'time-slot booked' : 'time-slot available';
                            const onclick = slot.booked ? '' : `onclick="selectSlot('${id}', '${slot.time}', ${dayIndex})"`;
                            return `<div class="${classes}" id="${id}" ${onclick}>
                                <span class="time-text">${slot.time}</span>
                            </div>`;
                        }).join('')}
                    </div>
                </div>
            `).join('');
            
            planning.scrollTop = 0;
        }

        function switchDay(index) {
            currentDay = index;
            document.querySelectorAll('.day-tab').forEach((tab, i) => {
                tab.classList.toggle('active', i === index);
            });
            renderPlanning(index);
            hideValidation();
        }

        function selectSlot(id, time, dayIndex) {
            if (selectedSlot) {
                document.getElementById(selectedSlot)?.classList.remove('selected');
            }
            
            selectedSlot = id;
            document.getElementById(id).classList.add('selected');
            
            const days = getDays();
            const day = days[dayIndex];
            const [h, m] = time.split(':').map(Number);
            const end = new Date();
            end.setHours(h, m + 60);
            const endTime = `${String(end.getHours()).padStart(2, '0')}:${String(end.getMinutes()).padStart(2, '0')}`;
            
            document.getElementById('valDate').textContent = day.toLocaleDateString('fr-FR', { 
                weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' 
            });
            document.getElementById('valTime').textContent = `${time} â†’ ${endTime}`;
            
            showValidation();
        }

        function showValidation() {
            document.getElementById('validation').classList.add('show');
        }

        function hideValidation() {
            document.getElementById('validation').classList.remove('show');
            if (selectedSlot) {
                document.getElementById(selectedSlot)?.classList.remove('selected');
                selectedSlot = null;
            }
        }

        function confirmBooking() {
            const date = document.getElementById('valDate').textContent;
            const time = document.getElementById('valTime').textContent;
            const message = `ZCPSÂ© - Je confirme ma rÃ©servation pour le ${date} de ${time}`;
            window.location.href = `https://wa.me/${WHATSAPP}?text=${encodeURIComponent(message)}`;
        }

        renderDays();
        renderPlanning(0);
    </script>
</body>
</html>            left: -100%;
            width: 200%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0%, 100% { left: -100%; }
            50% { left: 100%; }
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ffa500, #ff69b4, #40e0d0, #ffa500);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 4s ease infinite;
            font-weight: 900;
            letter-spacing: 1px;
            text-shadow: 0 0 20px rgba(255,165,0,0.3);
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .header p {
            font-size: 15px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        .days-nav {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            background: rgba(10, 14, 39, 0.8);
            border-bottom: 2px solid rgba(255,165,0,0.3);
            scrollbar-width: none;
        }

        .days-nav::-webkit-scrollbar {
            display: none;
        }

        .day-tab {
            flex: 0 0 33.333%;
            padding: 18px 12px;
            text-align: center;
            border-right: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: all 0.3s;
            scroll-snap-align: start;
            background: transparent;
        }

        .day-tab.active {
            background: linear-gradient(135deg, rgba(255,165,0,0.3), rgba(255,105,180,0.3), rgba(64,224,208,0.3));
            border-bottom: 3px solid #ffa500;
            box-shadow: 0 4px 20px rgba(255,165,0,0.4);
        }

        .day-tab .day-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(135deg, #ffa500, #ff69b4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .day-tab.active .day-name {
            -webkit-text-fill-color: white;
        }

        .day-tab .day-date {
            font-size: 13px;
            opacity: 0.8;
        }

        .planning {
            padding: 16px;
            height: calc(100vh - 320px);
            overflow-y: auto;
        }

        .time-slot {
            padding: 22px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, rgba(255,165,0,0.08), rgba(255,105,180,0.08));
            border: 2px solid rgba(255,165,0,0.3);
            border-radius: 16px;
            text-align: center;
            font-size: 22px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            touch-action: manipulation;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .time-slot::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .time-slot:hover::before {
            left: 100%;
        }

        .time-slot:active {
            transform: scale(0.96);
        }

        .time-slot.available:hover {
            background: linear-gradient(135deg, rgba(255,165,0,0.25), rgba(255,105,180,0.25));
            border-color: #ffa500;
            box-shadow: 0 6px 25px rgba(255,165,0,0.4);
        }

        .time-slot.booked {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1));
            border-color: rgba(239, 68, 68, 0.3);
            color: rgba(255, 255, 255, 0.4);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .time-slot.selected {
            background: linear-gradient(135deg, #ffa500, #ff69b4, #40e0d0);
            background-size: 200% 200%;
            animation: gradientMove 3s ease infinite;
            border-color: transparent;
            box-shadow: 0 8px 30px rgba(255,165,0,0.6), 0 0 40px rgba(255,105,180,0.4);
            transform: scale(1.02);
        }

        @keyframes gradientMove {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .hour-separator {
            padding: 14px 0;
            font-size: 13px;
            color: rgba(255,165,0,0.7);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-align: center;
            margin: 8px 0;
        }

        .validation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 24px 20px;
            background: linear-gradient(135deg, #ffa500, #ff69b4, #40e0d0);
            background-size: 200% 200%;
            animation: gradientMove 4s ease infinite;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 -6px 30px rgba(255,165,0,0.5);
            border-top: 3px solid rgba(255,255,255,0.3);
        }

        .validation.show {
            transform: translateY(0);
        }

        .validation-info {
            text-align: center;
            margin-bottom: 16px;
        }

        .validation-time {
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 6px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .validation-date {
            font-size: 15px;
            opacity: 0.95;
            font-weight: 600;
        }

        .btn-validate {
            width: 100%;
            padding: 20px;
            background: rgba(255,255,255,0.95);
            color: #1a1042;
            border: none;
            border-radius: 16px;
            font-size: 20px;
            font-weight: 900;
            cursor: pointer;
            touch-action: manipulation;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn-validate:active {
            transform: scale(0.96);
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 24px;
            padding: 16px;
            background: rgba(10, 14, 39, 0.6);
            font-size: 13px;
            font-weight: 600;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-box {
            width: 20px;
            height: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .logo-watermark {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 11px;
            opacity: 0.4;
            color: rgba(255,165,0,0.6);
            font-weight: 600;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>âš¡ ZAPS RÃ©servation</h1>
        <p>By Lola â€¢ Choisissez votre crÃ©neau</p>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-box" style="background: linear-gradient(135deg, rgba(255,165,0,0.2), rgba(255,105,180,0.2)); border: 2px solid rgba(255,165,0,0.4);"></div>
            <span>Disponible</span>
        </div>
        <div class="legend-item">
            <div class="legend-box" style="background: rgba(239, 68, 68, 0.2); border: 2px solid rgba(239, 68, 68, 0.4);"></div>
            <span>RÃ©servÃ©</span>
        </div>
    </div>

    <div class="days-nav" id="daysNav"></div>
    <div class="planning" id="planning"></div>

    <div class="validation" id="validation">
        <div class="validation-info">
            <div class="validation-date" id="valDate"></div>
            <div class="validation-time" id="valTime"></div>
        </div>
        <button class="btn-validate" onclick="confirmBooking()">
            âœ“ Confirmer sur WhatsApp
        </button>
    </div>

    <div class="logo-watermark">Zaps by Lola</div>

    <script>
        const WHATSAPP = '33605656753';
        let selectedSlot = null;
        let currentDay = 0;

        // CrÃ©neaux rÃ©servÃ©s (Ã  connecter avec Google Calendar)
        const bookedSlots = {
            '2025-11-29': ['14:30', '10:00'],
            '2025-11-30': ['16:15']
        };

        function getDays() {
            const days = [];
            for (let i = 0; i < 7; i++) {
                const d = new Date();
                d.setDate(d.getDate() + i);
                days.push(d);
            }
            return days;
        }

        function formatDayName(date, index) {
            if (index === 0) return 'Aujourd\'hui';
            if (index === 1) return 'Demain';
            return date.toLocaleDateString('fr-FR', { weekday: 'short' });
        }

        function formatDate(date) {
            return date.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' });
        }

        function getDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        function isBooked(date, time) {
            const key = getDateKey(date);
            return bookedSlots[key]?.includes(time) || false;
        }

        function generateTimeSlots(date, isToday) {
            const now = new Date();
            const startHour = isToday ? now.getHours() : 0;
            const slots = [];
            let currentHour = -1;

            for (let h = startHour; h < 24; h++) {
                for (let m = 0; m < 60; m += 15) {
                    const time = `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
                    const booked = isBooked(date, time);
                    
                    if (h !== currentHour) {
                        slots.push({ type: 'separator', hour: h });
                        currentHour = h;
                    }
                    
                    slots.push({ type: 'slot', time, booked, date });
                }
            }
            return slots;
        }

        function renderDays() {
            const days = getDays();
            const nav = document.getElementById('daysNav');
            nav.innerHTML = days.map((day, i) => `
                <div class="day-tab ${i === 0 ? 'active' : ''}" onclick="switchDay(${i})">
                    <div class="day-name">${formatDayName(day, i)}</div>
                    <div class="day-date">${formatDate(day)}</div>
                </div>
            `).join('');
        }

        function renderPlanning(dayIndex) {
            const days = getDays();
            const day = days[dayIndex];
            const slots = generateTimeSlots(day, dayIndex === 0);
            const planning = document.getElementById('planning');
            
            planning.innerHTML = slots.map((item, i) => {
                if (item.type === 'separator') {
                    return `<div class="hour-separator">âš¡ ${String(item.hour).padStart(2, '0')}h00</div>`;
                }
                
                const id = `${getDateKey(item.date)}_${item.time}`;
                const classes = item.booked ? 'time-slot booked' : 'time-slot available';
                const onclick = item.booked ? '' : `onclick="selectSlot('${id}', '${item.time}', ${dayIndex})"`;
                
                return `<div class="${classes}" id="${id}" ${onclick}>${item.time}</div>`;
            }).join('');
            
            planning.scrollTop = 0;
        }

        function switchDay(index) {
            currentDay = index;
            document.querySelectorAll('.day-tab').forEach((tab, i) => {
                tab.classList.toggle('active', i === index);
            });
            renderPlanning(index);
            hideValidation();
        }

        function selectSlot(id, time, dayIndex) {
            if (selectedSlot) {
                document.getElementById(selectedSlot)?.classList.remove('selected');
            }
            
            selectedSlot = id;
            document.getElementById(id).classList.add('selected');
            
            const days = getDays();
            const day = days[dayIndex];
            const [h, m] = time.split(':').map(Number);
            const end = new Date();
            end.setHours(h, m + 60);
            const endTime = `${String(end.getHours()).padStart(2, '0')}:${String(end.getMinutes()).padStart(2, '0')}`;
            
            document.getElementById('valDate').textContent = day.toLocaleDateString('fr-FR', { 
                weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' 
            });
            document.getElementById('valTime').textContent = `${time} â†’ ${endTime}`;
            
            showValidation();
        }

        function showValidation() {
            document.getElementById('validation').classList.add('show');
        }

        function hideValidation() {
            document.getElementById('validation').classList.remove('show');
            if (selectedSlot) {
                document.getElementById(selectedSlot)?.classList.remove('selected');
                selectedSlot = null;
            }
        }

        function confirmBooking() {
            const date = document.getElementById('valDate').textContent;
            const time = document.getElementById('valTime').textContent;
            const message = `âš¡ ZAPS - Je confirme ma rÃ©servation pour le ${date} de ${time}`;
            window.location.href = `https://wa.me/${WHATSAPP}?text=${encodeURIComponent(message)}`;
        }

        // Init
        renderDays();
        renderPlanning(0);
    </script>
</body>
                                                        </html>
