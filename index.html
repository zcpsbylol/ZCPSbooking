<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0a0e27">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>Ze CoffeePorn Shop</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700;800&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            font-family: 'Inter', -apple-system, sans-serif;
            background: #0a0e27;
            color: #fff;
        }

        /* ZONE DE CONFORT POUCE (bas de l'Ã©cran) */
        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
            height: 100dvh;
        }

        /* HEADER COMPACT */
        .header {
            flex-shrink: 0;
            padding: max(env(safe-area-inset-top), 16px) 20px 16px;
            background: linear-gradient(180deg, #1a1f3a 0%, #0a0e27 100%);
            text-align: center;
            border-bottom: 1px solid rgba(212,175,55,0.2);
        }

        .brand {
            font-size: 20px;
            font-weight: 800;
            color: #D4AF37;
            letter-spacing: 0.5px;
        }

        /* ONGLETS JOURS - GRANDES ZONES TACTILES */
        .days {
            flex-shrink: 0;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1px;
            background: rgba(212,175,55,0.15);
            padding: 1px;
        }

        .day {
            padding: 16px 12px;
            background: #0a0e27;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 64px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 4px;
        }

        .day.active {
            background: linear-gradient(135deg, #B8941E, #D4AF37);
            color: #0a0e27;
        }

        .day-label {
            font-size: 13px;
            font-weight: 700;
            opacity: 0.9;
        }

        .day.active .day-label {
            opacity: 1;
        }

        .day-num {
            font-size: 11px;
            opacity: 0.7;
        }

        .day.active .day-num {
            opacity: 0.85;
        }

        /* SCROLL INDICATORS */
        .scroll-hint {
            flex-shrink: 0;
            padding: 8px;
            text-align: center;
            font-size: 11px;
            color: rgba(212,175,55,0.5);
            background: rgba(26,31,58,0.4);
        }

        /* PLANNING - ZONE PRINCIPALE */
        .planning {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            padding: 0 16px 120px;
        }

        .planning::-webkit-scrollbar {
            display: none;
        }

        /* CRÃ‰NEAUX - OPTIMISÃ‰S POUR LE POUCE */
        .slot-group {
            margin: 20px 0;
        }

        .slot-hour {
            font-size: 12px;
            font-weight: 700;
            color: rgba(212,175,55,0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            padding-left: 4px;
        }

        .slot {
            min-height: 56px;
            padding: 16px 20px;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.04);
            border: 2px solid rgba(212,175,55,0.25);
            border-radius: 14px;
            font-size: 18px;
            font-weight: 700;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            touch-action: manipulation;
        }

        .slot:active {
            transform: scale(0.97);
        }

        .slot.booked {
            background: rgba(139,69,19,0.12);
            border-color: rgba(139,69,19,0.3);
            color: rgba(255,255,255,0.35);
            cursor: not-allowed;
        }

        .slot.booked::after {
            content: "ðŸ”’";
            position: absolute;
            right: 20px;
            font-size: 16px;
            opacity: 0.5;
        }

        .slot.selected {
            background: linear-gradient(135deg, #B8941E, #D4AF37, #FFD700);
            border-color: transparent;
            color: #0a0e27;
            font-weight: 800;
            box-shadow: 0 8px 24px rgba(212,175,55,0.4);
        }

        .slot.selected::after {
            content: "âœ“";
            position: absolute;
            right: 20px;
            font-size: 22px;
            color: #0a0e27;
        }

        /* BOUTON DE VALIDATION - ZONE POUCE */
        .actions {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px 16px max(env(safe-area-inset-bottom), 16px);
            background: rgba(10,14,39,0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(212,175,55,0.3);
            transform: translateY(120%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 100;
        }

        .actions.show {
            transform: translateY(0);
        }

        .actions::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #B8941E, #D4AF37, #FFD700);
        }

        .selection-info {
            text-align: center;
            margin-bottom: 12px;
        }

        .selection-date {
            font-size: 12px;
            color: rgba(212,175,55,0.8);
            margin-bottom: 4px;
        }

        .selection-time {
            font-size: 20px;
            font-weight: 800;
            color: #FFD700;
        }

        .btn {
            width: 100%;
            min-height: 56px;
            padding: 16px;
            background: linear-gradient(135deg, #B8941E, #D4AF37);
            border: none;
            border-radius: 14px;
            color: #0a0e27;
            font-size: 17px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(212,175,55,0.35);
            transition: all 0.2s;
            touch-action: manipulation;
        }

        .btn:active {
            transform: scale(0.97);
            box-shadow: 0 3px 10px rgba(212,175,55,0.4);
        }

        /* LOADER */
        .loader {
            position: fixed;
            inset: 0;
            background: #0a0e27;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.4s;
        }

        .loader.hide {
            opacity: 0;
            pointer-events: none;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid rgba(212,175,55,0.2);
            border-top-color: #D4AF37;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* EMPTY STATE */
        .empty {
            padding: 60px 20px;
            text-align: center;
            color: rgba(212,175,55,0.5);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-text {
            font-size: 15px;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
    </div>

    <!-- App -->
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="brand">â˜• Ze CoffeePorn Shop</div>
        </header>

        <!-- Jours -->
        <nav class="days" id="days"></nav>

        <!-- Hint -->
        <div class="scroll-hint">â†“ Faites dÃ©filer pour voir tous les crÃ©neaux</div>

        <!-- Planning -->
        <main class="planning" id="planning"></main>

        <!-- Actions -->
        <aside class="actions" id="actions">
            <div class="selection-info">
                <div class="selection-date" id="selDate"></div>
                <div class="selection-time" id="selTime"></div>
            </div>
            <button class="btn" onclick="confirm()">
                Confirmer sur WhatsApp
            </button>
        </aside>
    </div>

    <script>
        const WHATSAPP = "33605656753";
        const INTERVAL = 30; // minutes
        const OPEN = 8;
        const CLOSE = 22;
        
        const BOOKED = {
            "2025-12-03": ["10:00", "14:30"],
            "2025-12-04": ["16:00"]
        };

        let state = {
            currentDay: 0,
            selected: null
        };

        // UTILS
        const $ = id => document.getElementById(id);
        const $$ = sel => document.querySelectorAll(sel);

        function getDays() {
            return Array.from({length: 7}, (_, i) => {
                const d = new Date();
                d.setDate(d.getDate() + i);
                return d;
            });
        }

        function fmt(date, opts) {
            return date.toLocaleDateString('fr-FR', opts);
        }

        function key(date) {
            return date.toISOString().split('T')[0];
        }

        function dayLabel(date, i) {
            if (i === 0) return "Aujourd'hui";
            if (i === 1) return "Demain";
            return fmt(date, {weekday: 'short'}).toUpperCase();
        }

        function isBooked(date, time) {
            return BOOKED[key(date)]?.includes(time) || false;
        }

        function getSlots(date, isToday) {
            const now = new Date();
            let start = OPEN;
            
            if (isToday && now.getHours() >= OPEN) {
                start = now.getHours();
            }

            const slots = {};
            
            for (let h = start; h < CLOSE; h++) {
                slots[h] = [];
                for (let m = 0; m < 60; m += INTERVAL) {
                    const time = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
                    slots[h].push({
                        time,
                        booked: isBooked(date, time)
                    });
                }
            }
            
            return slots;
        }

        // RENDER
        function renderDays() {
            const days = getDays();
            $('days').innerHTML = days.slice(0,3).map((d, i) => `
                <div class="day ${i === 0 ? 'active' : ''}" onclick="switchDay(${i})">
                    <div class="day-label">${dayLabel(d, i)}</div>
                    <div class="day-num">${d.getDate()} ${fmt(d, {month: 'short'})}</div>
                </div>
            `).join('');
        }

        function renderPlanning(dayIndex) {
            const days = getDays();
            const date = days[dayIndex];
            const slots = getSlots(date, dayIndex === 0);
            const planning = $('planning');

            if (Object.keys(slots).length === 0) {
                planning.innerHTML = `
                    <div class="empty">
                        <div class="empty-icon">ðŸ˜´</div>
                        <div class="empty-text">Aucun crÃ©neau disponible aujourd'hui</div>
                    </div>
                `;
                return;
            }

            planning.innerHTML = Object.entries(slots).map(([hour, times]) => `
                <div class="slot-group">
                    <div class="slot-hour">${hour}:00</div>
                    ${times.map(s => {
                        const id = `s-${s.time.replace(':','')}`;
                        const cls = s.booked ? 'slot booked' : 'slot';
                        const click = s.booked ? '' : `onclick="select('${s.time}', ${dayIndex})"`;
                        return `<div id="${id}" class="${cls}" ${click}>${s.time}</div>`;
                    }).join('')}
                </div>
            `).join('');

            planning.scrollTop = 0;
        }

        function switchDay(i) {
            state.currentDay = i;
            state.selected = null;
            
            $$('.day').forEach((d, idx) => {
                d.classList.toggle('active', idx === i);
            });
            
            $('actions').classList.remove('show');
            renderPlanning(i);
        }

        function select(time, dayIndex) {
            // Deselect old
            if (state.selected) {
                $(`s-${state.selected.replace(':','')}`).classList.remove('selected');
            }

            // Select new
            state.selected = time;
            $(`s-${time.replace(':','')}`).classList.add('selected');

            // Update info
            const days = getDays();
            const date = days[dayIndex];
            const [h, m] = time.split(':');
            const end = new Date(date);
            end.setHours(parseInt(h), parseInt(m) + INTERVAL);
            const endTime = `${String(end.getHours()).padStart(2,'0')}:${String(end.getMinutes()).padStart(2,'0')}`;

            $('selDate').textContent = fmt(date, {weekday: 'long', day: 'numeric', month: 'long'});
            $('selTime').textContent = `${time} â†’ ${endTime}`;

            // Show panel
            $('actions').classList.add('show');
        }

        function confirm() {
            const date = $('selDate').textContent;
            const time = $('selTime').textContent;
            const msg = `â˜• Ze CoffeePorn Shop - RÃ©servation ${date} de ${time}`;
            window.location.href = `https://wa.me/${WHATSAPP}?text=${encodeURIComponent(msg)}`;
        }

        // INIT
        window.addEventListener('load', () => {
            setTimeout(() => $('loader').classList.add('hide'), 400);
        });

        renderDays();
        renderPlanning(0);
    </script>
</body>
</html>
